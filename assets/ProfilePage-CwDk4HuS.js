import{d as L,u as E,C as U,w as d,i as q,j as g,k as B,b as e,t as n,m as t,f as l,x as u,_ as h,l as F,q as b,E as $,U as R,J as H}from"./index-BYtlHEAg.js";import{t as O,o as z,s as v,u as J,a as y}from"./vee-validate-zod-DMy80Ona.js";import{e as k,a as Y}from"./index-DGW2OPUm.js";import{_ as Z}from"./AppShell.vue_vue_type_script_setup_true_lang-CLwHBfE0.js";import{_ as w}from"./AppInput.vue_vue_type_script_setup_true_lang-Bw9j5WbD.js";const G={class:"max-w-6xl"},I={class:"space-y-6 lg:grid lg:grid-cols-[360px_1fr] lg:gap-8 lg:space-y-0 lg:items-start"},K={class:"space-y-6"},Q={class:"bg-white rounded-xl border border-surface-100 shadow-sm p-6 space-y-5"},W={class:"flex items-center gap-4"},X={class:"h-14 w-14 rounded-full bg-primary-600 flex items-center justify-center shrink-0"},ee={class:"text-white text-xl font-bold select-none"},se={class:"text-base font-semibold text-surface-900"},te={class:"text-xs text-surface-400 mt-0.5"},ae={class:"border-t border-surface-100 pt-4 space-y-3"},oe={class:"flex items-center justify-between text-sm"},re={class:"font-medium text-surface-900"},ne={class:"flex items-center justify-between text-sm"},le={class:"font-medium text-surface-900"},ie={class:"bg-white rounded-xl border border-surface-100 shadow-sm p-6"},de={class:"bg-white rounded-xl border border-red-200 shadow-sm p-6 space-y-3"},ue={class:"bg-white rounded-xl border border-surface-100 shadow-sm p-6 space-y-4"},me={class:"grid grid-cols-2 gap-4"},ce={class:"text-xs text-surface-400 -mt-2 px-0.5"},fe={class:"font-medium text-surface-600"},ve=L({__name:"ProfilePage",setup(pe){const a=E(),{confirm:C}=H(),i=q(),P=$(()=>{const o=a.user;return o?o.first_name?o.first_name.charAt(0).toUpperCase():o.email.charAt(0).toUpperCase():"?"}),A=O(z({first_name:v().min(1,"Required").max(100),last_name:v().min(1,"Required").max(100),phone_number:v().max(20,"Too long").regex(/^\d*$/,"Digits only").optional()})),N=J({validationSchema:A,initialValues:{first_name:a.user?.first_name??"",last_name:a.user?.last_name??"",phone_number:a.user?.phone_number??""}}),{value:m,errorMessage:S}=y("first_name"),{value:c,errorMessage:T}=y("last_name"),{value:f,errorMessage:D}=y("phone_number"),p=g(!1),V=N.handleSubmit(async o=>{p.value=!0;try{await a.updateProfile({first_name:o.first_name,last_name:o.last_name,phone_number:o.phone_number||null}),i.success("Profile updated")}catch(s){i.error(k(s))}finally{p.value=!1}}),_=g(!1),x=g(!1);async function M(){_.value=!0;try{await a.logout()}finally{_.value=!1}}async function j(){if(await C({title:"Delete Account",message:"This will permanently delete your account and all your data including transactions, categories, and payment methods. This cannot be undone. Are you absolutely sure?",confirmLabel:"Delete Account",danger:!0})){x.value=!0;try{await R.deleteMe(),i.success("Account deleted"),await a.logout()}catch(s){i.error(k(s))}finally{x.value=!1}}}return(o,s)=>(B(),U(Z,null,{default:d(()=>[e("div",G,[e("div",I,[e("div",K,[e("div",Q,[e("div",W,[e("div",X,[e("span",ee,n(P.value),1)]),e("div",null,[e("p",se,n(t(a).user?.display_name),1),e("p",te," Member since "+n(t(a).user?.created_at?t(Y)(t(a).user.created_at):"—"),1)])]),e("div",ae,[e("div",oe,[s[4]||(s[4]=e("span",{class:"text-surface-500"},"Email (login)",-1)),e("span",re,n(t(a).user?.email),1)]),e("div",ne,[s[5]||(s[5]=e("span",{class:"text-surface-500"},"Phone number",-1)),e("span",le,n(t(a).user?.phone_number||"—"),1)]),s[6]||(s[6]=e("div",{class:"flex items-center justify-between text-sm"},[e("span",{class:"text-surface-500"},"Auth method"),e("span",{class:"font-medium text-surface-900"},"OTP (Passwordless)")],-1))])]),e("div",ie,[s[8]||(s[8]=e("h3",{class:"text-sm font-semibold text-surface-700 mb-4"},"Session",-1)),l(h,{variant:"outline",loading:_.value,onClick:M},{default:d(()=>[...s[7]||(s[7]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),u(" Sign Out ",-1)])]),_:1},8,["loading"])]),e("div",de,[s[10]||(s[10]=e("h3",{class:"text-sm font-semibold text-red-600"},"Danger Zone",-1)),s[11]||(s[11]=e("p",{class:"text-xs text-surface-500"}," Permanently deletes your account and all data including transactions, categories, and payment methods. This cannot be undone. ",-1)),l(h,{variant:"danger",loading:x.value,onClick:j},{default:d(()=>[...s[9]||(s[9]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),u(" Delete Account ",-1)])]),_:1},8,["loading"])])]),e("div",null,[e("div",ue,[s[14]||(s[14]=e("h3",{class:"text-sm font-semibold text-surface-700"},"Edit Profile",-1)),e("form",{class:"space-y-4",onSubmit:s[3]||(s[3]=F((...r)=>t(V)&&t(V)(...r),["prevent"]))},[e("div",me,[l(w,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=r=>b(m)?m.value=r:null),label:"First Name",placeholder:"Demo",required:"",error:t(S)},null,8,["modelValue","error"]),l(w,{modelValue:t(c),"onUpdate:modelValue":s[1]||(s[1]=r=>b(c)?c.value=r:null),label:"Last Name",placeholder:"User",required:"",error:t(T)},null,8,["modelValue","error"])]),l(w,{modelValue:t(f),"onUpdate:modelValue":s[2]||(s[2]=r=>b(f)?f.value=r:null),label:"Phone Number (optional)",placeholder:"9876543210",type:"tel",inputmode:"numeric",autocomplete:"tel-national",error:t(D)},null,8,["modelValue","error"]),e("div",ce,[s[12]||(s[12]=u(" Your login email: ",-1)),e("span",fe,n(t(a).user?.email),1)]),l(h,{type:"submit",loading:p.value,variant:"primary"},{default:d(()=>[...s[13]||(s[13]=[u(" Save Changes ",-1)])]),_:1},8,["loading"])],32)])])])])]),_:1}))}});export{ve as default};
