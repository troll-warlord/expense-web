import{d as K,z as Q,B as X,C as j,w as c,i as Y,j as $,k as r,b as e,f as a,x as p,_ as g,m as n,c as u,F as k,r as C,t as l,y as v,n as Z,q as D,l as ee,s as te,E,J as se}from"./index-BYtlHEAg.js";import{t as oe,o as re,c as ae,s as ne,u as le,a as z}from"./vee-validate-zod-DMy80Ona.js";import{u as ie}from"./budgets-B8aD8xRY.js";import{e as F}from"./index-DGW2OPUm.js";import{_ as de}from"./AppShell.vue_vue_type_script_setup_true_lang-CLwHBfE0.js";import{_ as ue,a as ce}from"./AppModal.vue_vue_type_script_setup_true_lang-q5JyDnhF.js";import{_ as me}from"./AppInput.vue_vue_type_script_setup_true_lang-Bw9j5WbD.js";import{_ as y}from"./AppSkeleton.vue_vue_type_script_setup_true_lang-Dnr6u1Oa.js";const fe={class:"max-w-4xl space-y-6"},pe={class:"flex items-start justify-between gap-4"},ge={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ve={class:"flex justify-between"},ye={key:1,class:"bg-white rounded-xl border border-surface-100 shadow-sm px-6 py-14 text-center"},xe={key:2,class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},_e={class:"flex items-start justify-between gap-2"},he={class:"text-sm font-semibold text-surface-900"},be={class:"flex items-center gap-1 shrink-0"},we=["onClick"],ke=["onClick"],Ce={class:"flex justify-between text-xs mb-1.5"},Be={class:"text-surface-500"},Me={class:"flex justify-between text-xs"},Se={class:"font-semibold text-surface-900 mt-0.5"},Ve={class:"text-right"},je={class:"text-surface-400"},$e={class:"text-right"},De={class:"font-semibold text-surface-900 mt-0.5"},Ee=["value","disabled"],ze={class:"flex gap-2 pt-1"},Ue=K({__name:"BudgetsPage",setup(Fe){const i=ie(),N=Q(),{confirm:A}=se(),m=Y();X(async()=>{i.loaded||await i.fetchBudgets()});const I=E(()=>N.categories.filter(s=>s.type==="expense")),f=$(!1),d=$(null);function B(){d.value=null,M({values:{category_id:"",amount:0}}),f.value=!0}function L(s){d.value=s,M({values:{category_id:s.category_id??"",amount:s.amount}}),f.value=!0}function x(){f.value=!1,d.value=null}const O=oe(re({category_id:ne(),amount:ae.number({invalid_type_error:"Enter a valid amount"}).positive("Amount must be positive").refine(s=>Math.round(s*100)/100===s,"At most 2 decimal places")})),{handleSubmit:T,isSubmitting:H,resetForm:M}=le({validationSchema:O}),{value:_,errorMessage:R}=z("category_id"),{value:h,errorMessage:U}=z("amount"),S=T(async s=>{try{const t={category_id:s.category_id===""?null:s.category_id,amount:s.amount,period:"monthly"};d.value?(await i.updateBudget(d.value.id,{amount:s.amount}),m.success("Budget updated")):(await i.createBudget(t),m.success("Budget created")),x()}catch(t){m.error(F(t))}});async function q(s){const t=s.category?s.category.name:"Overall Spending";if(await A({title:"Delete Budget",message:`Delete the budget for "${t}"?`,confirmLabel:"Delete",danger:!0}))try{await i.deleteBudget(s.id),m.success("Budget deleted")}catch(w){m.error(F(w))}}function J(s){return s>=100?"bg-red-500":s>=80?"bg-yellow-400":"bg-emerald-500"}function P(s){return s>=100?"bg-red-100":s>=80?"bg-yellow-100":"bg-emerald-100"}function W(s){return s>=100?"Over budget":s>=80?"Almost full":"On track"}function G(s){return s>=100?"text-red-600":s>=80?"text-yellow-600":"text-emerald-600"}function b(s){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s)}const V=E(()=>new Set(i.budgets.filter(s=>s.id!==d.value?.id).map(s=>s.category_id??"__overall__")));return(s,t)=>(r(),j(de,null,{default:c(()=>[e("div",fe,[e("div",pe,[t[4]||(t[4]=e("div",null,[e("h2",{class:"text-base font-semibold text-surface-900"},"Budgets"),e("p",{class:"text-xs text-surface-400 mt-0.5"}," Set monthly spending limits per category. We'll track actual spend from your transactions. ")],-1)),a(g,{size:"sm",onClick:B},{default:c(()=>[...t[3]||(t[3]=[e("svg",{class:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),p(" Add Budget ",-1)])]),_:1})]),n(i).loading?(r(),u("div",ge,[(r(),u(k,null,C(4,o=>e("div",{key:o,class:"bg-white rounded-xl border border-surface-100 shadow-sm p-5 space-y-3"},[a(y,{class:"h-4 w-32"}),a(y,{class:"h-2.5 w-full rounded-full"}),e("div",ve,[a(y,{class:"h-3 w-20"}),a(y,{class:"h-3 w-20"})])])),64))])):n(i).budgets.length===0?(r(),u("div",ye,[t[6]||(t[6]=e("div",{class:"mx-auto mb-3 h-10 w-10 rounded-full bg-primary-50 flex items-center justify-center"},[e("svg",{class:"h-5 w-5 text-primary-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t[7]||(t[7]=e("p",{class:"text-sm font-medium text-surface-700"},"No budgets yet",-1)),t[8]||(t[8]=e("p",{class:"text-xs text-surface-400 mt-1"},"Create a budget to start tracking your spending",-1)),a(g,{class:"mt-4",size:"sm",onClick:B},{default:c(()=>[...t[5]||(t[5]=[p("Add your first budget",-1)])]),_:1})])):(r(),u("div",xe,[(r(!0),u(k,null,C(n(i).budgets,o=>(r(),u("div",{key:o.id,class:"bg-white rounded-xl border border-surface-100 shadow-sm p-5 space-y-4"},[e("div",_e,[e("div",null,[e("p",he,l(o.category?o.category.name:"Overall Spending"),1),t[9]||(t[9]=e("p",{class:"text-xs text-surface-400 mt-0.5"},"Monthly Budget",-1))]),e("div",be,[e("button",{class:"rounded-lg p-1.5 text-surface-400 hover:text-primary-600 hover:bg-primary-50 transition-colors",title:"Edit budget",onClick:w=>L(o)},[...t[10]||(t[10]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,we),e("button",{class:"rounded-lg p-1.5 text-surface-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Delete budget",onClick:w=>q(o)},[...t[11]||(t[11]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ke)])]),e("div",null,[e("div",Ce,[e("span",{class:v([G(o.percent),"font-medium"])},l(W(o.percent)),3),e("span",Be,l(Math.min(o.percent,999).toFixed(0))+"%",1)]),e("div",{class:v(["relative h-2 rounded-full overflow-hidden",P(o.percent)])},[e("div",{class:v(["h-full rounded-full transition-all duration-500",J(o.percent)]),style:Z({width:`${Math.min(o.percent,100)}%`})},null,6)],2)]),e("div",Me,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-surface-400"},"Spent",-1)),e("p",Se,l(b(o.spent)),1)]),e("div",Ve,[e("p",je,l(o.remaining>=0?"Remaining":"Over by"),1),e("p",{class:v(["font-semibold mt-0.5",o.remaining>=0?"text-surface-900":"text-red-600"])},l(b(Math.abs(o.remaining))),3)]),e("div",$e,[t[13]||(t[13]=e("p",{class:"text-surface-400"},"Limit",-1)),e("p",De,l(b(o.amount)),1)])])]))),128))]))]),f.value?(r(),j(ue,{key:0,title:d.value?"Edit Budget":"Add Budget",size:"sm",onClose:x},{default:c(()=>[e("form",{class:"p-6 space-y-4",onSubmit:t[2]||(t[2]=ee((...o)=>n(S)&&n(S)(...o),["prevent"]))},[a(ce,{modelValue:n(_),"onUpdate:modelValue":t[0]||(t[0]=o=>D(_)?_.value=o:null),label:"Category",disabled:!!d.value,error:n(R)},{default:c(()=>[t[14]||(t[14]=e("option",{value:""},"Overall Spending",-1)),(r(!0),u(k,null,C(I.value,o=>(r(),u("option",{key:o.id,value:o.id,disabled:V.value.has(o.id)},l(o.name)+l(V.value.has(o.id)?" (already budgeted)":""),9,Ee))),128))]),_:1},8,["modelValue","disabled","error"]),a(me,{modelValue:n(h),"onUpdate:modelValue":t[1]||(t[1]=o=>D(h)?h.value=o:null),type:"number",label:"Monthly limit",placeholder:"e.g. 5000",step:"0.01",min:"0.01",error:n(U)},null,8,["modelValue","error"]),e("div",ze,[a(g,{type:"submit",class:"flex-1",loading:n(H)},{default:c(()=>[p(l(d.value?"Save Changes":"Create Budget"),1)]),_:1},8,["loading"]),a(g,{type:"button",variant:"ghost",class:"flex-1",onClick:x},{default:c(()=>[...t[15]||(t[15]=[p(" Cancel ",-1)])]),_:1})])],32)]),_:1},8,["title"])):te("",!0)]),_:1}))}});export{Ue as default};
